$(function(){var o={controller:"/favorite/favorite",add_method:"add",remove_method:"remove",get_add_url:function(){return this.controller+"/"+this.add_method},get_remove_url:function(){return this.controller+"/"+this.remove_method},add:function(o,e,i){this.request(this.get_add_url(),{name:o,id:e},i)},remove:function(o,e,i){this.request(this.get_remove_url(),{name:o,id:e},i)},request:function(o,e,i){$.ajax(o,{type:"POST",cache:!1,dataType:"json",data:e}).done(i)}},e={debug:!1,cookieName:"favorite_cookie",add:function(o,e,i){this.initCookie();var t=$.cookie(this.cookieName);if(null!==t){var a=o+"-"+e,r=$.parseJSON(t);if(null===r)return this.debug&&console.warn("Error: problem with cookie. Cookie: ",t),!1;var n=$.inArray(a,r);if(this.debug&&console.log("Storage: ",r),this.debug&&console.log("Entity: ",a),this.debug&&console.log("Position: ",n),-1==n){r.push(a);var s=JSON.stringify(r);$.cookie(this.cookieName,s,{path:"/"})}else this.debug&&console.log("Entity is already in favorite");i()}else this.debug&&console.warn("Error: problem with cookie. Cookie: ",t)},remove:function(o,e,i){this.initCookie();var t=$.cookie(this.cookieName);if(null!==t){var a=o+"-"+e,r=$.parseJSON(t);if(null===r)return this.debug&&console.warn("Error: problem with cookie. Cookie: ",t),!1;var n=$.inArray(a,r);if(this.debug&&console.log("Storage: ",r),this.debug&&console.log("Entity: ",a),this.debug&&console.log("Position: ",n),n>=0){r.splice(n,1);var s=JSON.stringify(r);$.cookie(this.cookieName,s,{path:"/"})}else this.debug&&console.log("Entity is not in favorite");i()}else this.debug&&console.warn("Error: problem with cookie. Cookie: ",t)},initCookie:function(){null===$.cookie(this.cookieName)||null===$.parseJSON($.cookie(this.cookieName))?($.cookie(this.cookieName,"[]",{path:"/"}),this.debug&&console.log("Set new cookie: ",$.cookie(this.cookieName))):this.debug&&console.log("Cookie is already set and valid: ",$.cookie(this.cookieName))}};$(document).on("click",".add_to_favorite_container",function(){var i=$(this).find(".add_to_favorite"),t=i.data("guest_mode")?e:o,a=1*$(".user__favourites sub").html();i.data("active")?t.remove(i.data("model_name"),i.data("model_id"),function(){i.data("active",!1),i.trigger("addToFavorite"),$(".user__favourites sub").html(a-1),a-1==0&&($(".favorites-link").addClass("hidden"),$(".cabinet-section.cabinet-section__favorites").removeClass("hidden"))}):t.add(i.data("model_name"),i.data("model_id"),function(){i.data("active",!0),i.trigger("addToFavorite"),$(".user__favourites sub").html(1*$(".user__favourites sub").html()+1)})})});
